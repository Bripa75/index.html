<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ripa Elevate Academy ‚Äì Business Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #050816;
      --bg-alt: #0b1020;
      --bg-card: #111827;
      --accent: #6366f1;
      --accent-soft: rgba(99, 102, 241, 0.12);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f87171;
      --success: #4ade80;
      --border: #1f2937;
      --radius-lg: 16px;
      --radius-md: 10px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
      display: flex;
      min-height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: 260px;
      background: linear-gradient(180deg, #020617, #020617 50%, #020617);
      border-right: 1px solid var(--border);
      padding: 20px 18px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #6366f1, #0ea5e9 40%, #020617 70%);
      box-shadow: 0 0 30px rgba(129, 140, 248, 0.5);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-text h1 {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .brand-text span {
      font-size: 11px;
      color: var(--muted);
    }

    .nav-section-title {
      font-size: 11px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 6px;
      margin-top: 8px;
    }

    .nav-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .nav-item button {
      width: 100%;
      background: transparent;
      border: none;
      text-align: left;
      padding: 9px 10px;
      border-radius: 10px;
      color: var(--muted);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.16s ease-out;
    }

    .nav-item button span.icon {
      font-size: 14px;
      width: 18px;
      text-align: center;
    }

    .nav-item button:hover {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
    }

    .nav-item button.active {
      background: linear-gradient(90deg, rgba(99, 102, 241, 0.24), transparent);
      border: 1px solid rgba(129, 140, 248, 0.55);
      color: var(--text);
      box-shadow: 0 0 18px rgba(79, 70, 229, 0.45);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      color: var(--muted);
      border-top: 1px solid var(--border);
      padding-top: 12px;
    }

    .sidebar-footer strong {
      color: var(--accent);
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 18px 22px;
      gap: 16px;
      overflow: hidden;
      position: relative;
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .main-title-group h2 {
      font-size: 20px;
      font-weight: 600;
    }

    .main-title-group span {
      font-size: 12px;
      color: var(--muted);
    }

    .tag-pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 4px 10px;
      font-size: 11px;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.12), transparent 70%);
    }

    .tag-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 8px var(--success);
    }

    .edit-button {
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.7);
      background: radial-gradient(circle at top left, rgba(129, 140, 248, 0.3), transparent 60%);
      color: #e5e7eb;
      padding: 6px 12px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 0 18px rgba(79, 70, 229, 0.5);
      margin-left: 10px;
    }

    .edit-button span.icon {
      font-size: 14px;
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
      overflow-y: auto;
      padding-bottom: 10px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.12), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(37, 99, 235, 0.2), transparent 65%),
                  var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31, 41, 55, 0.8);
      padding: 14px 14px 12px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .card-header h3 {
      font-size: 13px;
      font-weight: 500;
      color: #e5e7eb;
    }

    .card-header span {
      font-size: 11px;
      color: var(--muted);
    }

    .stat-main {
      font-size: 22px;
      font-weight: 600;
      margin-top: 3px;
      margin-bottom: 3px;
    }

    .stat-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(31, 41, 55, 0.9);
      color: var(--muted);
    }

    .pill.positive {
      color: var(--success);
      border-color: rgba(74, 222, 128, 0.5);
    }

    .pill.negative {
      color: var(--danger);
      border-color: rgba(248, 113, 113, 0.5);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: currentColor;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      padding: 6px 6px;
      text-align: left;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
    }

    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
      background: rgba(15, 23, 42, 0.9);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    tbody tr:hover {
      background: rgba(15, 23, 42, 0.8);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .badge.grade {
      border-color: rgba(96, 165, 250, 0.6);
      color: #bfdbfe;
    }

    .badge.college {
      border-color: rgba(34, 197, 94, 0.6);
      color: #bbf7d0;
    }

    .badge.subject {
      border-color: rgba(244, 114, 182, 0.6);
    }

    .chip-day {
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: var(--muted);
    }

    .ai-insight-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
      margin-top: 4px;
    }

    .ai-insight-list li {
      padding: 5px 7px;
      border-radius: 8px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(55, 65, 81, 0.9);
    }

    .ai-insight-list li strong {
      color: #e5e7eb;
    }

    .section-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .section-description {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    canvas {
      width: 100% !important;
      height: 250px !important;
    }

    .scroll-card {
      max-height: 260px;
      overflow-y: auto;
      border-radius: var(--radius-md);
    }

    /* Admin panel (slide-in on right) */
    .admin-panel {
      position: absolute;
      top: 0;
      right: -360px;
      width: 340px;
      height: 100%;
      background: radial-gradient(circle at top, #020617, #020617 50%, #020617);
      border-left: 1px solid var(--border);
      box-shadow: -18px 0 40px rgba(15, 23, 42, 0.9);
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: right 0.22s ease-out;
      z-index: 20;
    }

    .admin-panel.open {
      right: 0;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .admin-header h3 {
      font-size: 14px;
      font-weight: 500;
    }

    .admin-tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }

    .admin-tab-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--muted);
      font-size: 11px;
      padding: 4px 6px;
      cursor: pointer;
    }

    .admin-tab-btn.active {
      background: rgba(79, 70, 229, 0.3);
      border-color: rgba(129, 140, 248, 0.8);
      color: #e5e7eb;
    }

    .admin-body {
      flex: 1;
      overflow-y: auto;
      border-radius: var(--radius-md);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 8px;
      background: rgba(15, 23, 42, 0.95);
      font-size: 11px;
      color: var(--muted);
    }

    .admin-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 6px;
    }

    .admin-field label {
      font-size: 11px;
      color: var(--muted);
    }

    .admin-field input,
    .admin-field select,
    .admin-field textarea {
      border-radius: 8px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: #020617;
      color: #e5e7eb;
      font-size: 11px;
      padding: 4px 6px;
      outline: none;
    }

    .admin-field textarea {
      resize: vertical;
      min-height: 40px;
    }

    .admin-footer {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .btn-small {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 11px;
      padding: 5px 8px;
      cursor: pointer;
    }

    .btn-small.primary {
      background: rgba(79, 70, 229, 0.9);
      border-color: rgba(129, 140, 248, 0.9);
    }

    .btn-small.danger {
      border-color: rgba(248, 113, 113, 0.8);
      color: #fecaca;
    }

    .pill-info {
      font-size: 10px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    @media (max-width: 980px) {
      body {
        flex-direction: column;
      }
      .sidebar {
        flex-direction: row;
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border);
        overflow-x: auto;
      }
      .sidebar-footer {
        display: none;
      }
      .main {
        padding: 14px 12px;
      }
    }

    @media (max-width: 900px) {
      .grid-3 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .admin-panel {
        width: 100%;
      }
    }

    @media (max-width: 700px) {
      .grid-3, .grid-2 {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo"></div>
      <div class="brand-text">
        <h1>Ripa Elevate Academy</h1>
        <span>AI-Style Tutoring Ops Dashboard</span>
      </div>
    </div>

    <div>
      <div class="nav-section-title">Navigation</div>
      <ul class="nav-list">
        <li class="nav-item">
          <button class="active" data-section="overview">
            <span class="icon">üìä</span> Overview
          </button>
        </li>
        <li class="nav-item">
          <button data-section="students">
            <span class="icon">üë•</span> Students
          </button>
        </li>
        <li class="nav-item">
          <button data-section="schedule">
            <span class="icon">üóìÔ∏è</span> Schedule
          </button>
        </li>
        <li class="nav-item">
          <button data-section="payments">
            <span class="icon">üí∏</span> Payments
          </button>
        </li>
        <li class="nav-item">
          <button data-section="lessons">
            <span class="icon">‚úèÔ∏è</span> Lesson History
          </button>
        </li>
        <li class="nav-item">
          <button data-section="goals">
            <span class="icon">üéØ</span> Goals & Stats
          </button>
        </li>
      </ul>
    </div>

    <div class="sidebar-footer">
      <div>Private dashboard for <strong>Brian</strong>.</div>
      <div>All data is local in this file ‚Äì edit via the admin panel.</div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header class="main-header">
      <div class="main-title-group">
        <h2 id="page-title">Overview</h2>
        <span id="page-subtitle">High-level view of your tutoring business.</span>
      </div>
      <div style="display:flex; align-items:center; gap:8px;">
        <div class="tag-pill">
          <span class="dot"></span>
          Live layout ‚Ä¢ Data-driven ‚Ä¢ Local only
        </div>
        <button id="edit-toggle" class="edit-button">
          <span class="icon">üîß</span> Edit Dashboard
        </button>
      </div>
    </header>

    <section class="content">
      <!-- OVERVIEW SECTION -->
      <div id="section-overview">
        <div class="grid-3">
          <div class="card">
            <div class="card-header">
              <h3>Total Active Students</h3>
              <span>Currently scheduled</span>
            </div>
            <div class="stat-main" id="stat-total-students">‚Äì</div>
            <div class="stat-sub">You can expand or reduce as needed.</div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Weekly Teaching Hours</h3>
              <span>Based on schedule</span>
            </div>
            <div class="stat-main" id="stat-weekly-hours">‚Äì</div>
            <div class="stat-sub">Includes standard 1-hour blocks and Eva's 40-min session.</div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Projected Weekly Revenue</h3>
              <span>Zelle-based estimate</span>
            </div>
            <div class="stat-main" id="stat-weekly-revenue">$‚Äì</div>
            <div class="stat-sub">Assumes all scheduled sessions occur and are paid.</div>
          </div>
        </div>

        <div class="grid-2" style="margin-top: 10px;">
          <div class="card">
            <div class="card-header">
              <h3>AI-Style Business Insights</h3>
              <span>Auto-calculated from your data</span>
            </div>
            <ul class="ai-insight-list" id="ai-insights-list"></ul>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>Metrics Snapshot</h3>
              <span>Rates & distribution</span>
            </div>
            <div style="display:flex; flex-direction:column; gap:6px; font-size:12px; margin-top:4px;">
              <div>
                <span class="pill" id="pill-avg-rate">
                  Avg hourly rate: ‚Äì
                </span>
              </div>
              <div>
                <span class="pill" id="pill-total-sessions">
                  Weekly sessions: ‚Äì
                </span>
              </div>
              <div>
                <span class="pill">
                  Payment method: Zelle (per-session / weekly / advance)
                </span>
              </div>
              <div class="section-description" style="margin-top:6px;">
                These are basic analytics now, but you could later connect this
                to a backend or real AI for forecasting, churn prediction, etc.
              </div>
            </div>
          </div>
        </div>

        <div class="grid-2" style="margin-top: 8px;">
          <div class="card">
            <div class="card-header">
              <h3>Hours per Day</h3>
              <span>Visualized from your schedule</span>
            </div>
            <canvas id="chart-hours-per-day"></canvas>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>Students by Grade</h3>
              <span>Elementary vs. middle vs. high/college</span>
            </div>
            <canvas id="chart-students-by-grade"></canvas>
          </div>
        </div>
      </div>

      <!-- STUDENTS SECTION -->
      <div id="section-students" style="display:none;">
        <div class="card">
          <div class="card-header">
            <h3>Students</h3>
            <span>Full list of everyone you currently tutor.</span>
          </div>
          <div class="scroll-card">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Grade</th>
                  <th>Rate</th>
                  <th>Subjects</th>
                  <th>Weekly Sessions</th>
                </tr>
              </thead>
              <tbody id="students-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SCHEDULE SECTION -->
      <div id="section-schedule" style="display:none;">
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h3>Weekly Schedule</h3>
              <span>Organized by day & time</span>
            </div>
            <div class="scroll-card">
              <table>
                <thead>
                  <tr>
                    <th>Day</th>
                    <th>Time</th>
                    <th>Student</th>
                    <th>Duration</th>
                  </tr>
                </thead>
                <tbody id="schedule-table-body"></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>Schedule Insights</h3>
              <span>Load & distribution</span>
            </div>
            <ul class="ai-insight-list" id="schedule-insights-list"></ul>
          </div>
        </div>
      </div>

      <!-- PAYMENTS SECTION -->
      <div id="section-payments" style="display:none;">
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h3>Payment Overview</h3>
              <span>Zelle-based revenue structure</span>
            </div>
            <div class="section-description">
              This is a projected view based on your schedule √ó rate. When you start
              tracking real payments, you can expand this into a full ledger.
            </div>
            <div class="scroll-card">
              <table>
                <thead>
                  <tr>
                    <th>Student</th>
                    <th>Rate</th>
                    <th>Weekly Sessions</th>
                    <th>Projected Weekly Revenue</th>
                  </tr>
                </thead>
                <tbody id="payments-table-body"></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3>Payment Notes</h3>
              <span>How you collect money now</span>
            </div>
            <ul class="ai-insight-list">
              <li>üí∏ <strong>Primary method:</strong> All payments done via <strong>Zelle</strong>.</li>
              <li>üßæ Some parents pay <strong>per session</strong>, others <strong>weekly</strong>, others <strong>4 weeks in advance</strong>. You can add that as a column later.</li>
              <li>üìà This dashboard currently shows <strong>projected revenue</strong>. A next step could be adding a ‚ÄúPaid / Not Paid Yet‚Äù log with dates.</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- LESSONS SECTION -->
      <div id="section-lessons" style="display:none;">
        <div class="card">
          <div class="card-header">
            <h3>Lesson History</h3>
            <span>Log topics, homework, and notes</span>
          </div>
          <div class="section-description">
            Use the admin panel to add entries for each session. This table updates automatically.
          </div>
          <div class="scroll-card">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Student</th>
                  <th>Subject</th>
                  <th>Main Topic / Skill</th>
                  <th>Homework Given</th>
                  <th>Notes / Next Time</th>
                </tr>
              </thead>
              <tbody id="lessons-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- GOALS SECTION -->
      <div id="section-goals" style="display:none;">
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h3>Business Goals</h3>
              <span>Use this like your control center</span>
            </div>
            <div id="goals-list" class="section-description"></div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Stats Summary</h3>
              <span>Derived from your current data</span>
            </div>
            <div id="goals-stats-content" style="font-size:12px;"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ADMIN PANEL -->
    <aside id="admin-panel" class="admin-panel">
      <div class="admin-header">
        <h3>Admin Panel</h3>
        <button id="close-admin" class="btn-small">Close</button>
      </div>
      <div class="pill-info">
        Edit your data here. Changes are saved locally in your browser (localStorage).
      </div>
      <div class="admin-tabs">
        <button class="admin-tab-btn active" data-admin-tab="students">Students</button>
        <button class="admin-tab-btn" data-admin-tab="sessions">Sessions</button>
        <button class="admin-tab-btn" data-admin-tab="goals">Goals</button>
        <button class="admin-tab-btn" data-admin-tab="lessons">Lessons</button>
      </div>
      <div class="admin-body">
        <!-- STUDENTS TAB -->
        <div id="admin-tab-students">
          <div class="admin-field">
            <label for="student-select">Select student to edit</label>
            <select id="student-select"></select>
          </div>
          <div class="admin-field">
            <label for="student-name">Name</label>
            <input id="student-name" type="text" />
          </div>
          <div class="admin-field">
            <label for="student-grade">Grade (e.g., 4th, 6th, College)</label>
            <input id="student-grade" type="text" />
          </div>
          <div class="admin-field">
            <label for="student-rate">Hourly rate (number)</label>
            <input id="student-rate" type="number" step="1" />
          </div>
          <div class="admin-field">
            <label for="student-subjects">Subjects (comma-separated)</label>
            <input id="student-subjects" type="text" placeholder="Math, English" />
          </div>
          <div class="admin-footer">
            <button id="save-student" class="btn-small primary">Save Student</button>
            <button id="new-student" class="btn-small">New</button>
            <button id="delete-student" class="btn-small danger">Delete</button>
          </div>
        </div>

        <!-- SESSIONS TAB -->
        <div id="admin-tab-sessions" style="display:none;">
          <div class="admin-field">
            <label for="session-select">Select session to edit</label>
            <select id="session-select"></select>
          </div>
          <div class="admin-field">
            <label for="session-day">Day</label>
            <select id="session-day">
              <option>Monday</option>
              <option>Tuesday</option>
              <option>Wednesday</option>
              <option>Thursday</option>
              <option>Friday</option>
              <option>Saturday</option>
              <option>Sunday</option>
            </select>
          </div>
          <div class="admin-field">
            <label for="session-start">Start time (e.g., 5:00 pm)</label>
            <input id="session-start" type="text" />
          </div>
          <div class="admin-field">
            <label for="session-end">End time (e.g., 6:00 pm)</label>
            <input id="session-end" type="text" />
          </div>
          <div class="admin-field">
            <label for="session-duration">Duration (minutes)</label>
            <input id="session-duration" type="number" step="5" />
          </div>
          <div class="admin-field">
            <label for="session-student">Student</label>
            <select id="session-student"></select>
          </div>
          <div class="admin-field">
            <label for="session-rate">Rate override (optional, blank = use student's rate)</label>
            <input id="session-rate" type="number" step="1" />
          </div>
          <div class="admin-field">
            <label for="session-subject">Subject (optional, e.g., Precalculus, History)</label>
            <input id="session-subject" type="text" />
          </div>
          <div class="admin-footer">
            <button id="save-session" class="btn-small primary">Save Session</button>
            <button id="new-session" class="btn-small">New</button>
            <button id="delete-session" class="btn-small danger">Delete</button>
          </div>
        </div>

        <!-- GOALS TAB -->
        <div id="admin-tab-goals" style="display:none;">
          <div class="admin-field">
            <label for="goal-weekly-income">Weekly income goal ($)</label>
            <input id="goal-weekly-income" type="number" step="1" />
          </div>
          <div class="admin-field">
            <label for="goal-monthly-income">Monthly income goal ($)</label>
            <input id="goal-monthly-income" type="number" step="1" />
          </div>
          <div class="admin-field">
            <label for="goal-target-students">Target active students</label>
            <input id="goal-target-students" type="number" step="1" />
          </div>
          <div class="admin-field">
            <label for="goal-target-hours">Target hours per week</label>
            <input id="goal-target-hours" type="number" step="0.5" />
          </div>
          <div class="admin-field">
            <label for="goal-notes">Other goals / notes</label>
            <textarea id="goal-notes" placeholder="Future: hire tutors, build online course, etc."></textarea>
          </div>
          <div class="admin-footer">
            <button id="save-goals" class="btn-small primary">Save Goals</button>
          </div>
        </div>

        <!-- LESSONS TAB -->
        <div id="admin-tab-lessons" style="display:none;">
          <div class="admin-field">
            <label for="lesson-select">Select lesson (optional)</label>
            <select id="lesson-select"></select>
          </div>
          <div class="admin-field">
            <label for="lesson-date">Date (e.g., 2025-11-17)</label>
            <input id="lesson-date" type="text" />
          </div>
          <div class="admin-field">
            <label for="lesson-student">Student</label>
            <select id="lesson-student"></select>
          </div>
          <div class="admin-field">
            <label for="lesson-subject">Subject</label>
            <input id="lesson-subject" type="text" />
          </div>
          <div class="admin-field">
            <label for="lesson-topic">Main Topic / Skill</label>
            <input id="lesson-topic" type="text" />
          </div>
          <div class="admin-field">
            <label for="lesson-homework">Homework Given</label>
            <textarea id="lesson-homework"></textarea>
          </div>
          <div class="admin-field">
            <label for="lesson-notes">Notes / Next Time</label>
            <textarea id="lesson-notes"></textarea>
          </div>
          <div class="admin-footer">
            <button id="save-lesson" class="btn-small primary">Save Lesson</button>
            <button id="new-lesson" class="btn-small">New</button>
            <button id="delete-lesson" class="btn-small danger">Delete</button>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // ==========
    // STORAGE / DEFAULT DATA
    // ==========

    const STORAGE_KEY_STUDENTS = "rea_students_v1";
    const STORAGE_KEY_SESSIONS = "rea_sessions_v1";
    const STORAGE_KEY_GOALS = "rea_goals_v1";
    const STORAGE_KEY_LESSONS = "rea_lessons_v1";

    const defaultStudents = [
      { id: "diana", name: "Diana", grade: "4th", hourlyRate: 40, subjects: ["Math", "English"] },
      { id: "lucas", name: "Lucas", grade: "6th", hourlyRate: 45, subjects: ["ELA", "Writing"] },
      { id: "eva", name: "Eva", grade: "4th", hourlyRate: 27, subjects: ["Math"], sessionMinutes: 40 },
      { id: "milana", name: "Milana", grade: "4th", hourlyRate: 45, subjects: ["Math", "English"] },
      { id: "leo", name: "Leo", grade: "1st", hourlyRate: 30, subjects: ["Reading", "Writing"] },
      { id: "stephanie", name: "Stephanie", grade: "4th", hourlyRate: 35, subjects: ["English", "Writing"] },
      { id: "gabriel", name: "Gabriel", grade: "College", hourlyRate: 60, subjects: ["Precalculus", "History"] },
      { id: "maksim", name: "Maksim", grade: "7th", hourlyRate: 65, subjects: ["Math"] },
      { id: "savion", name: "Savion", grade: "College", hourlyRate: 60, subjects: ["Math"] },
      { id: "eric", name: "Eric", grade: "College", hourlyRate: 75, subjects: ["Precalculus"] },
      { id: "timothy", name: "Timothy", grade: "4th", hourlyRate: 60, subjects: ["Math"] },
    ];

    const defaultSessions = [
      { id: "s1", day: "Monday",   start: "6:30 pm", end: "7:30 pm", durationMinutes: 60, studentId: "diana" },
      { id: "s2", day: "Tuesday",  start: "4:20 pm", end: "5:00 pm", durationMinutes: 40, studentId: "eva" },
      { id: "s3", day: "Tuesday",  start: "5:00 pm", end: "6:00 pm", durationMinutes: 60, studentId: "lucas" },
      { id: "s4", day: "Tuesday",  start: "7:00 pm", end: "8:00 pm", durationMinutes: 60, studentId: "timothy" },
      { id: "s5", day: "Thursday", start: "3:00 pm", end: "4:00 pm", durationMinutes: 60, studentId: "leo" },
      { id: "s6", day: "Thursday", start: "5:00 pm", end: "6:00 pm", durationMinutes: 60, studentId: "lucas" },
      { id: "s7", day: "Thursday", start: "6:00 pm", end: "7:00 pm", durationMinutes: 60, studentId: "stephanie" },
      // Friday (Gabriel math)
      { id: "s8", day: "Friday",   start: "1:00 pm", end: "2:00 pm", durationMinutes: 60, studentId: "gabriel", subject: "Precalculus", rateOverride: 60 },
      { id: "s9", day: "Friday",   start: "3:00 pm", end: "4:00 pm", durationMinutes: 60, studentId: "leo" },
      { id: "s10",day: "Friday",   start: "4:00 pm", end: "5:00 pm", durationMinutes: 60, studentId: "diana" },
      { id: "s11",day: "Friday",   start: "5:00 pm", end: "6:00 pm", durationMinutes: 60, studentId: "maksim" },
      // Saturday
      { id: "s12",day: "Saturday", start: "11:00 am",end: "12:00 pm",durationMinutes: 60, studentId: "milana" },
      // Sunday
      { id: "s13",day: "Sunday",   start: "10:00 am",end: "11:00 am",durationMinutes: 60, studentId: "maksim" },
      { id: "s14",day: "Sunday",   start: "11:00 am",end: "12:00 pm",durationMinutes: 60, studentId: "eric" },
      // Gabriel history on Sunday @ 85/hr
      { id: "s15",day: "Sunday",   start: "12:00 pm",end: "1:00 pm", durationMinutes: 60, studentId: "gabriel", subject: "History", rateOverride: 85 },
      // NOTE: Savion Friday time TBD ‚Äì you can add via admin.
    ];

    const defaultGoals = {
      weeklyIncome: "",
      monthlyIncome: "",
      targetStudents: "",
      targetHours: "",
      notes: "Future: hire tutors, build online course, grow revenue."
    };

    let students = [];
    let sessions = [];
    let lessons = [];
    let goals = {};

    function loadFromStorage() {
      try {
        const s = localStorage.getItem(STORAGE_KEY_STUDENTS);
        const se = localStorage.getItem(STORAGE_KEY_SESSIONS);
        const g = localStorage.getItem(STORAGE_KEY_GOALS);
        const l = localStorage.getItem(STORAGE_KEY_LESSONS);

        students = s ? JSON.parse(s) : defaultStudents.slice();
        sessions = se ? JSON.parse(se) : defaultSessions.slice();
        goals = g ? JSON.parse(g) : { ...defaultGoals };
        lessons = l ? JSON.parse(l) : [];
      } catch (e) {
        students = defaultStudents.slice();
        sessions = defaultSessions.slice();
        goals = { ...defaultGoals };
        lessons = [];
      }
    }

    function saveToStorage() {
      localStorage.setItem(STORAGE_KEY_STUDENTS, JSON.stringify(students));
      localStorage.setItem(STORAGE_KEY_SESSIONS, JSON.stringify(sessions));
      localStorage.setItem(STORAGE_KEY_GOALS, JSON.stringify(goals));
      localStorage.setItem(STORAGE_KEY_LESSONS, JSON.stringify(lessons));
    }

    function getStudentMap() {
      return Object.fromEntries(students.map(s => [s.id, s]));
    }

    // ==========
    // AGGREGATION
    // ==========

    function computeWeeklyHours() {
      const totalMinutes = sessions.reduce((acc, s) => acc + (s.durationMinutes || 0), 0);
      return totalMinutes / 60;
    }

    function computeWeeklyRevenue() {
      const studentById = getStudentMap();
      let total = 0;
      for (const s of sessions) {
        const student = studentById[s.studentId];
        if (!student) continue;
        if (student.id === "eva") {
          total += 27; // one flat fee per 40-min session
        } else {
          const rate = (s.rateOverride != null ? s.rateOverride : (student.hourlyRate || 0));
          total += rate * ((s.durationMinutes || 60) / 60);
        }
      }
      return total;
    }

    function computeAverageRate() {
      const hourlyStudents = students.filter(s => s.hourlyRate && s.hourlyRate > 0);
      if (hourlyStudents.length === 0) return 0;
      const sum = hourlyStudents.reduce((acc, s) => acc + s.hourlyRate, 0);
      return sum / hourlyStudents.length;
    }

    function computeSessionsPerStudent() {
      const map = {};
      for (const s of sessions) {
        map[s.studentId] = (map[s.studentId] || 0) + 1;
      }
      return map;
    }

    function computeRevenuePerStudent() {
      const studentById = getStudentMap();
      const map = {};
      for (const s of sessions) {
        const student = studentById[s.studentId];
        if (!student) continue;
        let amount = 0;
        if (student.id === "eva") {
          amount = 27;
        } else {
          const rate = (s.rateOverride != null ? s.rateOverride : (student.hourlyRate || 0));
          amount = rate * ((s.durationMinutes || 60) / 60);
        }
        map[s.studentId] = (map[s.studentId] || 0) + amount;
      }
      return map;
    }

    function computeHoursPerDay() {
      const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
      const map = {};
      for (const d of days) map[d] = 0;
      for (const s of sessions) {
        map[s.day] = (map[s.day] || 0) + ((s.durationMinutes || 60) / 60);
      }
      return map;
    }

    function computeStudentsByGrade() {
      const map = {};
      for (const s of students) {
        const g = s.grade || "Unknown";
        map[g] = (map[g] || 0) + 1;
      }
      return map;
    }

    // ==========
    // RENDERING
    // ==========

    let chartHours;
    let chartGrades;

    function renderOverview() {
      const totalStudents = students.length;
      const weeklyHours = computeWeeklyHours();
      const weeklyRevenue = computeWeeklyRevenue();
      const avgRate = computeAverageRate();
      const sessionsMap = computeSessionsPerStudent();
      const revenueMap = computeRevenuePerStudent();

      document.getElementById("stat-total-students").textContent = totalStudents;
      document.getElementById("stat-weekly-hours").textContent = weeklyHours.toFixed(2) + " hrs";
      document.getElementById("stat-weekly-revenue").textContent = "$" + weeklyRevenue.toFixed(2);

      document.getElementById("pill-avg-rate").textContent =
        "Avg hourly rate: $" + avgRate.toFixed(2);
      document.getElementById("pill-total-sessions").textContent =
        "Weekly sessions: " + sessions.length;

      const insightsList = document.getElementById("ai-insights-list");
      insightsList.innerHTML = "";

      let topStudentId = null, topRevenue = 0;
      for (const [id, rev] of Object.entries(revenueMap)) {
        if (rev > topRevenue) {
          topRevenue = rev;
          topStudentId = id;
        }
      }
      const studentById = getStudentMap();
      if (topStudentId) {
        const s = studentById[topStudentId];
        const li = document.createElement("li");
        li.innerHTML = `üí° <strong>Highest revenue student:</strong> ${s.name} brings approx <strong>$${topRevenue.toFixed(2)}</strong> per week.`;
        insightsList.appendChild(li);
      }

      let busiestStudentId = null, maxSessions = 0;
      for (const [id, count] of Object.entries(sessionsMap)) {
        if (count > maxSessions) {
          maxSessions = count;
          busiestStudentId = id;
        }
      }
      if (busiestStudentId) {
        const s = studentById[busiestStudentId];
        const li = document.createElement("li");
        li.innerHTML = `üìö <strong>Most frequent sessions:</strong> ${s.name} has <strong>${maxSessions}</strong> sessions per week.`;
        insightsList.appendChild(li);
      }

      const liWorkload = document.createElement("li");
      let workloadLabel = "balanced";
      if (weeklyHours < 10) workloadLabel = "light";
      else if (weeklyHours > 18) workloadLabel = "heavy";
      liWorkload.innerHTML =
        `‚è±Ô∏è <strong>Workload:</strong> About <strong>${weeklyHours.toFixed(2)} hours</strong> of tutoring per week (${workloadLabel} load).`;
      insightsList.appendChild(liWorkload);

      const gradeMap = computeStudentsByGrade();
      const liGrades = document.createElement("li");
      liGrades.innerHTML =
        "üë• <strong>Grade mix:</strong> " +
        Object.entries(gradeMap).map(([grade, count]) => `${grade}: ${count}`).join(" ‚Ä¢ ") +
        ".";
      insightsList.appendChild(liGrades);

      renderCharts();
    }

    function renderStudentsTable() {
      const tbody = document.getElementById("students-table-body");
      tbody.innerHTML = "";
      const sessionsMap = computeSessionsPerStudent();

      for (const s of students) {
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.textContent = s.name;
        tr.appendChild(tdName);

        const tdGrade = document.createElement("td");
        const gradeBadge = document.createElement("span");
        gradeBadge.className = "badge " + (s.grade === "College" ? "college" : "grade");
        gradeBadge.textContent = s.grade;
        tdGrade.appendChild(gradeBadge);
        tr.appendChild(tdGrade);

        const tdRate = document.createElement("td");
        if (s.id === "eva") tdRate.textContent = "$27 / 40 min";
        else tdRate.textContent = "$" + (s.hourlyRate || 0) + " / hr";
        tr.appendChild(tdRate);

        const tdSubjects = document.createElement("td");
        (s.subjects || []).forEach(subj => {
          const span = document.createElement("span");
          span.className = "badge subject";
          span.style.marginRight = "4px";
          span.textContent = subj;
          tdSubjects.appendChild(span);
        });
        tr.appendChild(tdSubjects);

        const tdSessions = document.createElement("td");
        tdSessions.textContent = sessionsMap[s.id] || 0;
        tr.appendChild(tdSessions);

        tbody.appendChild(tr);
      }
    }

    function renderScheduleTable() {
      const tbody = document.getElementById("schedule-table-body");
      tbody.innerHTML = "";

      const studentById = getStudentMap();
      const dayOrder = { Monday:1, Tuesday:2, Wednesday:3, Thursday:4, Friday:5, Saturday:6, Sunday:7 };
      const sessionsSorted = [...sessions].sort((a,b) => {
        if (a.day === b.day) return 0;
        return (dayOrder[a.day] || 10) - (dayOrder[b.day] || 10);
      });

      for (const s of sessionsSorted) {
        const tr = document.createElement("tr");

        const tdDay = document.createElement("td");
        const dayChip = document.createElement("span");
        dayChip.className = "chip-day";
        dayChip.textContent = s.day;
        tdDay.appendChild(dayChip);
        tr.appendChild(tdDay);

        const tdTime = document.createElement("td");
        tdTime.textContent = `${s.start} ‚Äì ${s.end}`;
        tr.appendChild(tdTime);

        const tdStudent = document.createElement("td");
        tdStudent.textContent = studentById[s.studentId]?.name || "Unknown";
        tr.appendChild(tdStudent);

        const tdDuration = document.createElement("td");
        tdDuration.textContent = ((s.durationMinutes || 60) / 60).toFixed(2) + " hrs";
        tr.appendChild(tdDuration);

        tbody.appendChild(tr);
      }

      const list = document.getElementById("schedule-insights-list");
      list.innerHTML = "";
      const hoursPerDay = computeHoursPerDay();
      const busiestDay = Object.entries(hoursPerDay).reduce(
        (best, curr) => (curr[1] > best[1] ? curr : best),
        ["Monday", 0]
      );

      const li1 = document.createElement("li");
      li1.innerHTML =
        `üóìÔ∏è <strong>Busiest day:</strong> ${busiestDay[0]} with ${busiestDay[1].toFixed(2)} hours.`;
      list.appendChild(li1);

      const li2 = document.createElement("li");
      li2.innerHTML = "üìÜ <strong>Empty day:</strong> Wednesday is currently free ‚Äì possible slot for new student(s).";
      list.appendChild(li2);

      const weekendHours = (hoursPerDay["Saturday"] || 0) + (hoursPerDay["Sunday"] || 0);
      const li3 = document.createElement("li");
      li3.innerHTML =
        `üìö <strong>Weekend teaching:</strong> ${weekendHours.toFixed(2)} hours across Saturday & Sunday.`;
      list.appendChild(li3);
    }

    function renderPaymentsTable() {
      const tbody = document.getElementById("payments-table-body");
      tbody.innerHTML = "";
      const sessionsMap = computeSessionsPerStudent();
      const revenueMap = computeRevenuePerStudent();

      for (const s of students) {
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.textContent = s.name;
        tr.appendChild(tdName);

        const tdRate = document.createElement("td");
        tdRate.textContent = s.id === "eva" ? "$27 / 40 min" : "$" + (s.hourlyRate || 0) + " / hr";
        tr.appendChild(tdRate);

        const tdSessions = document.createElement("td");
        tdSessions.textContent = sessionsMap[s.id] || 0;
        tr.appendChild(tdSessions);

        const tdRevenue = document.createElement("td");
        const revenue = revenueMap[s.id] || 0;
        tdRevenue.textContent = "$" + revenue.toFixed(2);
        tr.appendChild(tdRevenue);

        tbody.appendChild(tr);
      }
    }

    function renderLessonsTable() {
      const tbody = document.getElementById("lessons-table-body");
      tbody.innerHTML = "";
      const studentById = getStudentMap();
      for (const l of lessons) {
        const tr = document.createElement("tr");
        const tdDate = document.createElement("td");
        tdDate.textContent = l.date || "";
        tr.appendChild(tdDate);

        const tdStudent = document.createElement("td");
        tdStudent.textContent = studentById[l.studentId]?.name || "";
        tr.appendChild(tdStudent);

        const tdSubject = document.createElement("td");
        tdSubject.textContent = l.subject || "";
        tr.appendChild(tdSubject);

        const tdTopic = document.createElement("td");
        tdTopic.textContent = l.topic || "";
        tr.appendChild(tdTopic);

        const tdHW = document.createElement("td");
        tdHW.textContent = l.homework || "";
        tr.appendChild(tdHW);

        const tdNotes = document.createElement("td");
        tdNotes.textContent = l.notes || "";
        tr.appendChild(tdNotes);

        tbody.appendChild(tr);
      }
    }

    function renderGoals() {
      const container = document.getElementById("goals-list");
      const weekly = goals.weeklyIncome ? `$${goals.weeklyIncome}` : "(set a number)";
      const monthly = goals.monthlyIncome ? `$${goals.monthlyIncome}` : "(set a number)";
      const ts = goals.targetStudents || "(set)";
      const th = goals.targetHours || "(set)";
      const notes = goals.notes || "";

      container.innerHTML = `
        <ul class="ai-insight-list">
          <li>üéØ <strong>Weekly income goal:</strong> ${weekly}</li>
          <li>üéØ <strong>Monthly income goal:</strong> ${monthly}</li>
          <li>üë• <strong>Target active students:</strong> ${ts}</li>
          <li>‚è±Ô∏è <strong>Target hours/week:</strong> ${th}</li>
          ${notes ? `<li>üß† <strong>Other goals:</strong> ${notes}</li>` : ""}
        </ul>
      `;

      const summary = document.getElementById("goals-stats-content");
      const totalStudents = students.length;
      const hours = computeWeeklyHours();
      const revenue = computeWeeklyRevenue();
      const avgRate = computeAverageRate();

      summary.innerHTML = `
        <div style="display:flex; flex-direction:column; gap:4px;">
          <div><strong>Active students:</strong> ${totalStudents}</div>
          <div><strong>Weekly hours (scheduled):</strong> ${hours.toFixed(2)} hrs</div>
          <div><strong>Projected weekly revenue:</strong> $${revenue.toFixed(2)}</div>
          <div><strong>Average hourly rate:</strong> $${avgRate.toFixed(2)}</div>
          <div><strong>Sessions per week:</strong> ${sessions.length}</div>
          <div class="section-description" style="margin-top:6px;">
            As your business scales, this section could later plug into real analytics
            and forecasting models (e.g. predicting revenue based on new students added).
          </div>
        </div>
      `;
    }

    function renderCharts() {
      const hoursPerDay = computeHoursPerDay();
      const ctx1 = document.getElementById("chart-hours-per-day").getContext("2d");
      if (chartHours) chartHours.destroy();
      chartHours = new Chart(ctx1, {
        type: "bar",
        data: {
          labels: Object.keys(hoursPerDay),
          datasets: [{ label: "Hours", data: Object.values(hoursPerDay) }],
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: {
              ticks: { color: "#9ca3af", font: { size: 11 } },
              grid: { display: false },
            },
            y: {
              ticks: { color: "#9ca3af", font: { size: 11 } },
              grid: { color: "rgba(55, 65, 81, 0.5)" },
            },
          },
        },
      });

      const studentsByGrade = computeStudentsByGrade();
      const ctx2 = document.getElementById("chart-students-by-grade").getContext("2d");
      if (chartGrades) chartGrades.destroy();
      chartGrades = new Chart(ctx2, {
        type: "pie",
        data: {
          labels: Object.keys(studentsByGrade),
          datasets: [{ data: Object.values(studentsByGrade) }],
        },
        options: {
          plugins: {
            legend: {
              labels: { color: "#e5e7eb", font: { size: 11 } },
            },
          },
        },
      });
    }

    // ==========
    // ADMIN PANEL HELPERS
    // ==========

    function populateStudentSelects() {
      const studentSelect = document.getElementById("student-select");
      const sessionStudent = document.getElementById("session-student");
      const lessonStudent = document.getElementById("lesson-student");

      [studentSelect, sessionStudent, lessonStudent].forEach(sel => {
        sel.innerHTML = "";
        students.forEach(s => {
          const opt = document.createElement("option");
          opt.value = s.id;
          opt.textContent = s.name;
          sel.appendChild(opt);
        });
      });
    }

    function populateSessionSelect() {
      const sel = document.getElementById("session-select");
      sel.innerHTML = "";
      const studentById = getStudentMap();
      sessions.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        const name = studentById[s.studentId]?.name || "Unknown";
        opt.textContent = `${s.day} ‚Äì ${name} (${s.start}‚Äì${s.end})`;
        sel.appendChild(opt);
      });
    }

    function populateLessonSelect() {
      const sel = document.getElementById("lesson-select");
      sel.innerHTML = "";
      const studentById = getStudentMap();
      lessons.forEach((l, idx) => {
        const opt = document.createElement("option");
        opt.value = String(idx);
        opt.textContent = `${l.date || "No date"} ‚Äì ${studentById[l.studentId]?.name || ""}`;
        sel.appendChild(opt);
      });
    }

    function fillStudentFormById(id) {
      const s = students.find(st => st.id === id);
      if (!s) return;
      document.getElementById("student-name").value = s.name || "";
      document.getElementById("student-grade").value = s.grade || "";
      document.getElementById("student-rate").value = s.hourlyRate ?? "";
      document.getElementById("student-subjects").value = (s.subjects || []).join(", ");
    }

    function fillSessionFormById(id) {
      const s = sessions.find(se => se.id === id);
      if (!s) return;
      document.getElementById("session-day").value = s.day || "Monday";
      document.getElementById("session-start").value = s.start || "";
      document.getElementById("session-end").value = s.end || "";
      document.getElementById("session-duration").value = s.durationMinutes ?? 60;
      document.getElementById("session-student").value = s.studentId || "";
      document.getElementById("session-rate").value = s.rateOverride ?? "";
      document.getElementById("session-subject").value = s.subject || "";
    }

    function fillLessonFormIndex(idx) {
      const l = lessons[idx];
      if (!l) return;
      document.getElementById("lesson-date").value = l.date || "";
      document.getElementById("lesson-student").value = l.studentId || "";
      document.getElementById("lesson-subject").value = l.subject || "";
      document.getElementById("lesson-topic").value = l.topic || "";
      document.getElementById("lesson-homework").value = l.homework || "";
      document.getElementById("lesson-notes").value = l.notes || "";
    }

    function fillGoalsForm() {
      document.getElementById("goal-weekly-income").value = goals.weeklyIncome || "";
      document.getElementById("goal-monthly-income").value = goals.monthlyIncome || "";
      document.getElementById("goal-target-students").value = goals.targetStudents || "";
      document.getElementById("goal-target-hours").value = goals.targetHours || "";
      document.getElementById("goal-notes").value = goals.notes || "";
    }

    // ==========
    // NAVIGATION + ADMIN PANEL WIRES
    // ==========

    const navButtons = document.querySelectorAll(".nav-item button");
    const sections = {
      overview: document.getElementById("section-overview"),
      students: document.getElementById("section-students"),
      schedule: document.getElementById("section-schedule"),
      payments: document.getElementById("section-payments"),
      lessons: document.getElementById("section-lessons"),
      goals: document.getElementById("section-goals"),
    };

    function setActiveSection(key) {
      for (const [name, el] of Object.entries(sections)) {
        el.style.display = name === key ? "block" : "none";
      }
      navButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.section === key);
      });

      const pageTitle = document.getElementById("page-title");
      const pageSubtitle = document.getElementById("page-subtitle");

      const titles = {
        overview: ["Overview", "High-level view of your tutoring business."],
        students: ["Students", "Who you teach, what they pay, and what they study."],
        schedule: ["Schedule", "Your weekly tutoring workload by day."],
        payments: ["Payments", "Projected revenue based on your schedule."],
        lessons: ["Lesson History", "Log what you cover in each session."],
        goals: ["Goals & Stats", "Targets + auto-calculated stats from your data."],
      };

      pageTitle.textContent = titles[key][0];
      pageSubtitle.textContent = titles[key][1];
    }

    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        setActiveSection(btn.dataset.section);
      });
    });

    // Admin panel
    const adminPanel = document.getElementById("admin-panel");
    const editToggle = document.getElementById("edit-toggle");
    const closeAdmin = document.getElementById("close-admin");
    const adminTabButtons = document.querySelectorAll(".admin-tab-btn");

    editToggle.addEventListener("click", () => {
      adminPanel.classList.add("open");
      // Default tab = students
      setAdminTab("students");
    });

    closeAdmin.addEventListener("click", () => {
      adminPanel.classList.remove("open");
    });

    function setAdminTab(tab) {
      adminTabButtons.forEach(btn => {
        const isActive = btn.dataset.adminTab === tab;
        btn.classList.toggle("active", isActive);
      });
      document.getElementById("admin-tab-students").style.display = tab === "students" ? "block" : "none";
      document.getElementById("admin-tab-sessions").style.display = tab === "sessions" ? "block" : "none";
      document.getElementById("admin-tab-goals").style.display = tab === "goals" ? "block" : "none";
      document.getElementById("admin-tab-lessons").style.display = tab === "lessons" ? "block" : "none";
    }

    adminTabButtons.forEach(btn => {
      btn.addEventListener("click", () => setAdminTab(btn.dataset.adminTab));
    });

    // ==========
    // ADMIN: STUDENTS
    // ==========

    document.getElementById("student-select").addEventListener("change", e => {
      fillStudentFormById(e.target.value);
    });

    document.getElementById("save-student").addEventListener("click", () => {
      const select = document.getElementById("student-select");
      let id = select.value;

      if (!id) {
        // new student
        id = "s" + (Date.now());
        students.push({ id });
        select.value = id;
      }

      const s = students.find(st => st.id === id);
      if (!s) return;

      s.name = document.getElementById("student-name").value.trim() || "Unnamed";
      s.grade = document.getElementById("student-grade").value.trim() || "Unknown";
      s.hourlyRate = Number(document.getElementById("student-rate").value || 0);
      const subs = document.getElementById("student-subjects").value.trim();
      s.subjects = subs ? subs.split(",").map(x => x.trim()).filter(Boolean) : [];

      saveToStorage();
      populateStudentSelects();
      populateSessionSelect();
      renderAll();
    });

    document.getElementById("new-student").addEventListener("click", () => {
      document.getElementById("student-select").value = "";
      document.getElementById("student-name").value = "";
      document.getElementById("student-grade").value = "";
      document.getElementById("student-rate").value = "";
      document.getElementById("student-subjects").value = "";
    });

    document.getElementById("delete-student").addEventListener("click", () => {
      const id = document.getElementById("student-select").value;
      if (!id) return;
      if (!confirm("Delete this student and any sessions/lessons tied to them?")) return;
      students = students.filter(s => s.id !== id);
      sessions = sessions.filter(s => s.studentId !== id);
      lessons = lessons.filter(l => l.studentId !== id);
      saveToStorage();
      populateStudentSelects();
      populateSessionSelect();
      populateLessonSelect();
      renderAll();
      document.getElementById("new-student").click();
    });

    // ==========
    // ADMIN: SESSIONS
    // ==========

    document.getElementById("session-select").addEventListener("change", e => {
      fillSessionFormById(e.target.value);
    });

    document.getElementById("save-session").addEventListener("click", () => {
      const sel = document.getElementById("session-select");
      let id = sel.value;
      if (!id) {
        id = "session-" + Date.now();
        sessions.push({ id });
        sel.value = id;
      }
      const s = sessions.find(se => se.id === id);
      if (!s) return;

      s.day = document.getElementById("session-day").value;
      s.start = document.getElementById("session-start").value || "";
      s.end = document.getElementById("session-end").value || "";
      s.durationMinutes = Number(document.getElementById("session-duration").value || 60);
      s.studentId = document.getElementById("session-student").value;
      const ro = document.getElementById("session-rate").value;
      s.rateOverride = ro === "" ? undefined : Number(ro);
      s.subject = document.getElementById("session-subject").value || "";

      saveToStorage();
      populateSessionSelect();
      renderAll();
    });

    document.getElementById("new-session").addEventListener("click", () => {
      document.getElementById("session-select").value = "";
      document.getElementById("session-day").value = "Monday";
      document.getElementById("session-start").value = "";
      document.getElementById("session-end").value = "";
      document.getElementById("session-duration").value = 60;
      document.getElementById("session-student").value = students[0]?.id || "";
      document.getElementById("session-rate").value = "";
      document.getElementById("session-subject").value = "";
    });

    document.getElementById("delete-session").addEventListener("click", () => {
      const id = document.getElementById("session-select").value;
      if (!id) return;
      if (!confirm("Delete this session?")) return;
      sessions = sessions.filter(s => s.id !== id);
      saveToStorage();
      populateSessionSelect();
      renderAll();
      document.getElementById("new-session").click();
    });

    // ==========
    // ADMIN: GOALS
    // ==========

    document.getElementById("save-goals").addEventListener("click", () => {
      goals.weeklyIncome = document.getElementById("goal-weekly-income").value;
      goals.monthlyIncome = document.getElementById("goal-monthly-income").value;
      goals.targetStudents = document.getElementById("goal-target-students").value;
      goals.targetHours = document.getElementById("goal-target-hours").value;
      goals.notes = document.getElementById("goal-notes").value;
      saveToStorage();
      renderGoals();
    });

    // ==========
    // ADMIN: LESSONS
    // ==========

    document.getElementById("lesson-select").addEventListener("change", e => {
      const idx = Number(e.target.value);
      if (!Number.isNaN(idx)) fillLessonFormIndex(idx);
    });

    document.getElementById("save-lesson").addEventListener("click", () => {
      const sel = document.getElementById("lesson-select");
      let idx = sel.value === "" ? -1 : Number(sel.value);
      if (idx < 0 || idx >= lessons.length) {
        idx = lessons.length;
        lessons.push({});
        sel.value = String(idx);
      }
      const l = lessons[idx];
      l.date = document.getElementById("lesson-date").value || "";
      l.studentId = document.getElementById("lesson-student").value || "";
      l.subject = document.getElementById("lesson-subject").value || "";
      l.topic = document.getElementById("lesson-topic").value || "";
      l.homework = document.getElementById("lesson-homework").value || "";
      l.notes = document.getElementById("lesson-notes").value || "";

      saveToStorage();
      populateLessonSelect();
      renderLessonsTable();
    });

    document.getElementById("new-lesson").addEventListener("click", () => {
      document.getElementById("lesson-select").value = "";
      document.getElementById("lesson-date").value = "";
      document.getElementById("lesson-student").value = students[0]?.id || "";
      document.getElementById("lesson-subject").value = "";
      document.getElementById("lesson-topic").value = "";
      document.getElementById("lesson-homework").value = "";
      document.getElementById("lesson-notes").value = "";
    });

    document.getElementById("delete-lesson").addEventListener("click", () => {
      const sel = document.getElementById("lesson-select");
      if (sel.value === "") return;
      const idx = Number(sel.value);
      if (!confirm("Delete this lesson entry?")) return;
      lessons.splice(idx, 1);
      saveToStorage();
      populateLessonSelect();
      renderLessonsTable();
      document.getElementById("new-lesson").click();
    });

    // ==========
    // RENDER ALL
    // ==========

    function renderAll() {
      renderOverview();
      renderStudentsTable();
      renderScheduleTable();
      renderPaymentsTable();
      renderLessonsTable();
      renderGoals();
    }

    function init() {
      loadFromStorage();
      populateStudentSelects();
      populateSessionSelect();
      populateLessonSelect();
      fillStudentFormById(students[0]?.id);
      document.getElementById("student-select").value = students[0]?.id || "";
      fillGoalsForm();
      if (students[0]) {
        document.getElementById("session-student").value = students[0].id;
        document.getElementById("lesson-student").value = students[0].id;
      }
      renderAll();
      setActiveSection("overview");
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>

